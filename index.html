<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>RushLife Prototype (Atualizado)</title>
<style>
  :root{
    --bg:#0f0f0f;
    --panel:#222;
    --panel2:#2b2b2b;
    --text:#fff;
    --muted:#bdbdbd;
  }
  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family: Arial, sans-serif;
    height:100vh;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  #wrap{
    width:min(420px, 100vw);
    height:min(820px, 100vh);
    position:relative;
  }
  /* ==== GAME CANVAS ==== */
  #game{
    width:100%;
    height:100%;
    display:block;
    background:#0b0b0b;
    border-radius:18px;
    box-shadow:0 0 30px rgba(0,0,0,.6);
  }
  /* ==== HUD TOP ==== */
  #hudTop{
    position:absolute;
    top:12px;
    left:12px;
    right:12px;
    display:flex;
    gap:10px;
    align-items:flex-start;
    pointer-events:none;
  }
  .hudCard{
    background:rgba(20,20,20,.75);
    border:1px solid rgba(255,255,255,.08);
    backdrop-filter: blur(6px);
    border-radius:14px;
    padding:10px 12px;
    font-size:13px;
    pointer-events:none;
    white-space: pre-line;
  }
  #hudLeft{ min-width: 170px; }
  #hudRight{ margin-left:auto; text-align:right; }

  /* ==== TOAST ==== */
  #toast{
    position:absolute;
    left:50%;
    bottom:200px;
    transform:translateX(-50%);
    background:rgba(20,20,20,.9);
    border:1px solid rgba(255,255,255,.08);
    padding:10px 12px;
    border-radius:12px;
    display:none;
    max-width:340px;
    font-size:14px;
    text-align:center;
    box-shadow:0 10px 30px rgba(0,0,0,.35);
  }

  /* ==== PHONE OVERLAY ==== */
  #phoneOverlay{
    position:absolute;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,.55);
  }
  #phone{
    width:340px;
    height:610px;
    border-radius:28px;
    background:linear-gradient(180deg, #1c1c1c, #121212);
    box-shadow:0 0 35px rgba(0,0,0,.75);
    padding:18px;
  }
  #phone h2{ margin:4px 0 8px 0; }
  .muted{ color:var(--muted); font-size:13px; }
  .appbtn{
    width:100%;
    padding:12px 12px;
    margin:8px 0;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.08);
    background:var(--panel2);
    color:var(--text);
    font-size:16px;
  }
  .row{
    display:flex;
    gap:8px;
  }
  .row .appbtn{ flex:1; }

  /* ==== MOBILE CONTROLS ==== */
  #controls{
    position:absolute;
    left:12px; right:12px; bottom:12px;
    display:flex;
    justify-content:space-between;
    gap:12px;
    pointer-events:auto;
  }
  .pad{
    width:168px;
    height:168px;
    border-radius:18px;
    background:rgba(20,20,20,.55);
    border:1px solid rgba(255,255,255,.08);
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    grid-template-rows:repeat(3, 1fr);
    gap:6px;
    padding:10px;
    backdrop-filter: blur(6px);
  }
  .btn{
    border:none;
    border-radius:14px;
    background:rgba(255,255,255,.08);
    color:#fff;
    font-size:18px;
  }
  .btn:active{ transform:scale(.98); }
  .btn.empty{ background:transparent; }

  .actions{
    width:180px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .act{
    padding:12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.08);
    background:rgba(20,20,20,.55);
    color:#fff;
    font-size:16px;
    backdrop-filter: blur(6px);
  }
  .act:active{ transform:scale(.99); }
</style>
</head>
<body>
<div id="wrap">
  <canvas id="game" width="420" height="820"></canvas>

  <div id="hudTop">
    <div class="hudCard" id="hudLeft"></div>
    <div class="hudCard" id="hudRight"></div>
  </div>

  <div id="toast"></div>

  <!-- Phone overlay -->
  <div id="phoneOverlay">
    <div id="phone">
      <h2>üì± RushLife</h2>
      <div class="muted" id="phoneMeta"></div>
      <hr style="border-color:rgba(255,255,255,.08)">
      <div class="muted" id="phoneStatus"></div>
      <button class="appbtn" onclick="work('delivery')">üö¥ Trabalhar Entrega (+$20)</button>
      <button class="appbtn" onclick="work('uber')">üöó Trabalhar Uber (+$30)</button>
      <div class="row">
        <button class="appbtn" onclick="eat()">üçî Comer (-$15)</button>
        <button class="appbtn" onclick="sleep()">üåô Dormir</button>
      </div>
      <button class="appbtn" onclick="togglePhone()">‚¨ÖÔ∏è Fechar Celular</button>
      <div class="muted" style="margin-top:8px;">
        Dica: Voc√™ pode andar com os bot√µes e abrir o celular a qualquer momento.
      </div>
    </div>
  </div>

  <!-- Mobile controls -->
  <div id="controls">
    <div class="pad">
      <button class="btn empty"></button>
      <button class="btn" id="up">‚¨ÜÔ∏è</button>
      <button class="btn empty"></button>
      <button class="btn" id="left">‚¨ÖÔ∏è</button>
      <button class="btn empty"></button>
      <button class="btn" id="right">‚û°Ô∏è</button>
      <button class="btn empty"></button>
      <button class="btn" id="down">‚¨áÔ∏è</button>
      <button class="btn empty"></button>
    </div>
    <div class="actions">
      <button class="act" onclick="togglePhone()">üì± Celular</button>
      <button class="act" onclick="interact()">ü§ù Interagir</button>
      <button class="act" onclick="toggleWeather()">üå¶Ô∏è Trocar Clima</button>
    </div>
  </div>
</div>

<script>
/* =========================
   GAME STATE
========================= */
const game = {
  day: 1,
  hour: 8,
  minute: 0,
  climate: "Sol", // Sol | Chuva | Nublado | Frio
  hunger: 100,
  energy: 100,
  health: 100,
  money: 50,
  age: 18.00,
  // World
  mapW: 2000,
  mapH: 2000,
  player: { x: 1000, y: 1000, speed: 180 },
  npcs: [
    { x: 950, y: 1050, vx: 0, vy: 0, dirT: 0, talk:"Oi! Bom dia üòä" },
    { x: 1100, y: 980, vx: 0, vy: 0, dirT: 0, talk:"T√° chovendo hoje?" },
    { x: 1020, y: 1120, vx: 0, vy: 0, dirT: 0, talk:"Trabalhar t√° dif√≠cil..." }
  ],
  phoneOpen: false
};

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* =========================
   UI HELPERS
========================= */
function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

function fmtTime(){
  const hh = String(game.hour).padStart(2,"0");
  const mm = String(game.minute).padStart(2,"0");
  return `${hh}:${mm}`;
}

function updateHUD(){
  const left =
`üìÖ Dia ${game.day} ‚Ä¢ üïí ${fmtTime()}
üå¶Ô∏è ${game.climate}`;
  const right =
`üí∞ $${game.money}
üçî ${game.hunger}  ‚ö° ${game.energy}
‚ù§Ô∏è ${game.health}  üéÇ ${game.age.toFixed(2)}`;
  document.getElementById("hudLeft").textContent = left;
  document.getElementById("hudRight").textContent = right;
  document.getElementById("phoneMeta").textContent = `Dia ${game.day} ‚Ä¢ ${fmtTime()} ‚Ä¢ Clima: ${game.climate}`;
  document.getElementById("phoneStatus").innerHTML =
    `üí∞ Dinheiro: $${game.money}<br>`+
    `üçî Fome: ${game.hunger}<br>`+
    `‚ö° Energia: ${game.energy}<br>`+
    `‚ù§Ô∏è Sa√∫de: ${game.health}<br>`+
    `üéÇ Idade: ${game.age.toFixed(2)}`;
}

function togglePhone(){
  game.phoneOpen = !game.phoneOpen;
  document.getElementById("phoneOverlay").style.display = game.phoneOpen ? "flex" : "none";
}

/* ===== Toast (sem congelar jogo) ===== */
let toastT = null;
function notify(msg){
  const el = document.getElementById("toast");
  el.textContent = msg;
  el.style.display = "block";
  clearTimeout(toastT);
  toastT = setTimeout(()=> el.style.display = "none", 1600);
}

/* =========================
   TIME & STATS (otimizado)
========================= */
function advanceTime(totalMinutes){
  if(totalMinutes <= 0) return;

  // rel√≥gio
  let total = game.minute + totalMinutes;
  game.hour += Math.floor(total / 60);
  game.minute = total % 60;

  game.day += Math.floor(game.hour / 24);
  game.hour = game.hour % 24;

  // decay a cada 6 min
  const decays = Math.floor(totalMinutes / 6);
  if(decays > 0){
    game.hunger = clamp(game.hunger - decays, 0, 100);
    game.energy = clamp(game.en
  
